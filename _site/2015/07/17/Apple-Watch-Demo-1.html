<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Harry" />
    
    <title>Apple Watch开发系列（一）</title>
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="/atom.xml" rel="alternate" title="red3 harry" type="application/atom+xml" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/media/css/style.css">
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/retina.js/1.3.0/retina.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script type="text/javascript"> hljs.initHighlightingOnLoad(); </script>
  </head>
  <body>
      <div id="main" role="main">
        <header>
          <div id="header">
            <h1><a title="red3 harry" class="" href="/">red3 harry</a></h1>
          </div>
          <nav>
            
            <span><a title="Archive" href="/archive.html"><i class="fa fa-list-ul"></i></a></span>
            
            <span><a title="Tags" href="/tags.html"><i class="fa fa-tags"></i></a></span>
            
            <span><a title="About" href="/about.html"><i class="fa fa-user"></i></a></span>
            
            <span><a title="Gallery" href="http://redthree.lofter.com"><i class="fa fa-film"></i></a></span>
            
            <span><a title="Subscribe" href="/atom.xml"><i class="fa fa-rss"></i></a></span>
            
          </nav>
        </header>
        <div id="content">
        <article>
  <section class="title">
    <h2>Apple Watch开发系列（一） </h2>
  </section>
  <section class="meta">
  <span class="time">
    <time datetime="2015-07-17">2015-07-17</time>
  </span>
  
  <span class="tags">
    
    <a href="/tags.html#Apple Watch" title="Apple Watch">#Apple Watch</a>
    
    <a href="/tags.html#WWDC" title="WWDC">#WWDC</a>
    
  </span>
  <!-- BEGIN this would not work on any other domain -->
  <span
    class           = "like-wrapper"
    like-shortname  = 'gopherwood'
    like-identifier = ''
    like-name       = 'Apple Watch开发系列（一）'
    like-btn        = '&#xf087;'
    like-link       = '/2015/07/17/Apple-Watch-Demo-1.html'
    ></span>
  <script type="text/javascript">
    var l = document.createElement('script');
    l.type = 'text/javascript'; l.async = true; l.src = 'http://www.like-btn.com/javascript/widget.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(l);
  </script>
  <!-- END this would not work on any other domain -->
  
  </section>
  <section class="post">
  <p>本系列是我依据WWDC15 Session Video以及苹果官方文档写的一个小Demo，涉及的资料有</p>

<p>-<a href="https://developer.apple.com/videos/wwdc/2015/?id=108">Building Watch Apps</a></p>

<p>-<a href="https://developer.apple.com/library/prerelease/watchos/documentation/General/Conceptual/AppleWatch2TransitionGuide/index.html">AppleWatch2 Transition Guide</a></p>

<p>-<a href="https://developer.apple.com/library/prerelease/watchos/documentation/General/Conceptual/WatchKitProgrammingGuide/index.html">WatchKit Programming Guide</a></p>

<p>另外需要说明的是本Demo是基于Watch OS 2.0开发的，因为我开始学的时候已经是2.0了，哈哈。在该系列的每篇文章末尾会有一个链接地址，指向这个Demo。</p>

<h1 id="section">前言</h1>
<p>当然，首先我们要有一个iOS app，因为WatchKit app的bundle是集成与iOS app中的，安装Watch app的时候会把WatchKit app的bundle从iPhone中传输到Watch上。而对于Watch app来说，分为两个部分：WatchKit app(运行在Apple Watch)以及WatchKit extension(运行在iPhone上)。WatchKit app只包含程序UI相关的storyboards和资源文件（比如图片等），而WatchKit extension包含管理和响应UI的代码。
#添加Watch app Target</p>

<p>和添加一个iOS app target一样的步骤，如果我要添加了一个名为“Watch”的Target，顺序是下面这样的：
<img src="/assets/2015/img-watchdemo-1.png" alt="" /></p>

<p>选择Next以后，需要勾选这些东西：
<img src="/assets/2015/img-watchdemo-2.png" alt="" />
分别解释下这几个选项</p>

<ul>
  <li>Notification Scene 通知中心：应用程序收到远程或本地通知的时候，手表界面出现的通知布景。</li>
  <li>Glacne 速览。从表盘界面上拉出现的界面，添加到速览列表后，用户可以通过左右滑动速览界面，看到程序提供的速览界面，提供最重要的信息，不可滚动的，一屏，不可包含可交互元素，点击会启动WatchKit app</li>
  <li>Complication 特殊功能（或者叫功能栏）：抬起手腕可以在表盘上看见的东西，比如我的表盘上自定义的功能栏有日历、健身活动、定时器等。</li>
</ul>

<p>这些按需要勾选，确定以后，在WatchKit app的storyboard中就可以看到以下界面：
<img src="/assets/2015/img-watchdemo-3.png" alt="" />
图中的Main interface就是Watchkit app的主界面了，Glance Interface是速览界面，剩下的Static Interface和Dynamic Interface是连着一起的，可以这样解释：当Watch上收到iPhone的通知的时候，首先会调起程序对应的Static Interface，当用户对通知表示有兴趣，也就是说抬起了手腕想看这条通知的时候，会切换到对应的Dynamic Interface上。</p>

<p>此次，我们的任务就是把这几个Interface都运行起来，在Watch上看到效果。
#添加界面元素
暂时，我们可以先在各个界面上拖上一些简单的元素。这里需要注意的是Glance Interface上是不允许可交互元素（比如button，switch等）的存在的。
#编译运行
到现在为止，查看Scheme menu可以看到，Xcode已经为我们生成了调试不同界面的Scheme了。要编译运行main Interface我们选中Watch Scheme，就可以在模拟器上看到我们的main Interface了。
Glance和Notification Interface稍微还要费电周折，分别讲一下：</p>

<ul>
  <li>Glance</li>
</ul>

<p>要选择iOS app的target对应的Scheme，编译运行，在iPhone的“Watch”应用中，进入我们新建的iOS app设置界面，选中“Show In Glance”（在速览中显示）。然后回到Watch模拟器，从表盘界面往上滑动，再往右滑动，就可以看到我们创建的速览界面了。</p>

<ul>
  <li>Notification Scene</li>
</ul>

<p>在工程的“Edit Scheme”中，选择编辑“Notification-Watch”:
<img src="/assets/2015/img-watchdemo-4.png" alt="" />
有两个地方需要注意：</p>

<ol>
  <li>Watch Interface 可以切换Static Notification和Dynamic Notification来分别调试不同场景下的通知视图。当然可以通过左下角的Duplicate Scheme来复制一个Scheme，这样就分别有了Static Notification和Dynamic Notification对应的Scheme了。</li>
  <li>Notification Payload 在Watch Extension文件夹下的Support Fils下有一个名为“PushNotificationPayload.apns”的文件。这个文件是Xcode为我们自动生成的，因为模拟器不支持推送，所以通过这个文件模拟一个推送。我们可以修改这个文件的内容，以及创建新的payload文件，然后再来调试我们的程序。</li>
</ol>

<p>现在我们选中Static Notification的Scheme来编译运行，就可以看到模拟器上收到的通知内容为“Test Message”，而这个文字是从PushNotificationPayload.apns这个文件中读写出来的。</p>

<p>然后再选中Dynamic Notification的Scheme来编译运行，发现怎么还是刚才的通知，现在我们要移步到NotificationController.m这个文件下，将一下代码的注释打开</p>

<div class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">didReceiveRemoteNotification:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">remoteNotification</span> <span class="nf">withCompletion:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">WKUserNotificationInterfaceType</span><span class="p">))</span><span class="nv">completionHandler</span> <span class="p">{</span>
    <span class="c1">// This method is called when a remote notification needs to be presented.</span>
    <span class="c1">// Implement it if you use a dynamic notification interface.</span>
    <span class="c1">// Populate your dynamic notification interface as quickly as possible.</span>
    <span class="c1">//</span>
    <span class="c1">// After populating your dynamic notification interface call the completion block.</span>
    <span class="n">completionHandler</span><span class="p">(</span><span class="n">WKUserNotificationInterfaceTypeDefault</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>然后我们需要把下面这行代码中的”WKUserNotificationInterfaceTypeDefault”替换为”WKUserNotificationInterfaceTypeCustom”，然后重新编译运行，就发现我们定制的Dynamic Notification出现在屏幕上了。</p>

<pre><code>completionHandler(WKUserNotificationInterfaceTypeDefault);
</code></pre>

<h1 id="section-1">下期预告</h1>
<p>今天的系列就先到这里，下一系列讲讲怎么创建一个功能栏，就是抬腕可以在表盘上看见的那个东西。</p>

<ul>
  <li>惯例：<a href="https://github.com/red3/WatchDemo/archive/master.zip">点击这里下载Demo</a></li>
  <li>重要：因为博客暂时没有评论区，如果你对本文有什么疑惑，或者你发现本文由存在错误的地方，非常欢迎你联系我指出。QQ：309333018，WeiChat：flipgo</li>
</ul>


  </section>
  
</article>

        </div>
        <footer>
          <div>
            
            &copy; 2015 ~ 2015 Harry | powered by jekyll | themed by <a href="http://lhzhang.com" title="sext vi">sext vi</a> | fork <a href="https://github.com/red3" title="fork me">me</a>
          </div>
        </footer>
      </div> <!-- main -->
  </body>
</html>
