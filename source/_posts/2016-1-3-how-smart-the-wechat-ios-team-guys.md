---
layout: post
title:  "微信的开发同学真机智"
date:   2016-1-3 14:30:00
---

## 微信的开发同学真机智

这次事情的缘由是这样的：微信的最近升级去除了下拉录制小视频的功能，改为了仅仅拉出一张微信logo的图片。其实这里有个细节问题需要注意，因为SearchBar的背景是灰色，所以下拉出来的视图应该也是灰色，这样看着才是协调的。创建过置顶聊天的同学应该知道，置顶聊天的Cell也是灰色，其他Cell的背景是白色的。

![]()

当时我就想，这个需求其实只要把TableView的背景设置成灰色就可以了，然后在TableView的负坐标上加上一个图片就可以了，恩，就是这么简单。

然后，又滑了滑列表，毕竟是too young, too simple啊。

刚才说过，普通的Cell的背景是白色的，那么如果将TableView的背景设置成灰色，那么底部的Cell都滑尽后，会出现列表的背景灰色，这样就又会不协调。事实证明，微信这么注重细节的产品不会犯这种错误，滑动到列表底部，出现的还是白色背景。

所以仅仅改变TableView的背景色看来是不够的。


## 模拟实现
如果换我实现这个功能，我就保持列表的背景为白色，然后在负坐标上加一个View，View的背景是灰色的，View上再加上这个图片logo，然后在列表滑动的时候，需要动态改变这个View的高度，不然又会看见白色背景了。
当然这个实现稍微有点复杂，因为如果动态改变View的高度，那么就要监听TableView的滑动，如果这些监听放在ViewController里面去做，会显臃肿，如果坚持良好的设计模式的话，显然不太理想。不能在ViewController里面做这件事的话，可以考虑给TableView加一个拓展，在拓展里面让这个View注册为TableView的观察者，当TableView的offset变化时，让自身的高度变化。

## 验证

可不可以验证下，微信是怎么处理的，当然可以！

发现只有一个孤零零的UIImageview，可以肯定的是并没有按照上文那样用一个View去实现，就是简单的addSubView，现在可以推断TableView的背景应该就是灰色的了。

那底部的问题应该怎么处理呢？

![]()

可以从上面的图片中看到，第一个UIimageview就是微信logo图片，那么底部的问题应该就出在选中的UIView这一块，从frame属性中查看，发现高度是748，什么样的View竟然需要这么高的高度？相信你已经猜到什么了。

暴力一点，直接把这个View的高度改为10pt，背景色改为红色，然后效果是这样的：

![]()

Bingo, 果然就是在footerView上加了个背景为白色的很高的一个View。
如果你还有疑问，为什么这个高度是748，而不是848或者别的数字呢，如果你知道iPad横屏模式下高度为768pt，再减去状态栏的高度20pt，就是这个高度，意味着无论你怎么用力滑，都是滑不出这个高度的，真是机智啊！

这个时候有人不禁会问，真把footerView设置这么高，是会实打实划出这个距离的。因此只能把footerView的高度设置为0，然后在上面添加子View，让子View的高度为748，就是上图中的那个结构。

然后顺便看了下这个地方有两个view，那么另外一个view的作用是什么呢，根据frame发现，-0.5，h0.5，难道那个是最底部的那个横跨全屏的分割线？

在iPhone中仔细又研究了下：

看来果然是为了做横跨全屏的分割线啊，因为放大点是能看到最后的Cell的分割线跟这个ViewB重合了，但是左边分明能看到有没有重合的地方粗线不一样，哈哈，看来细心如微信，也有疏忽的地方啊！


## 后记

为什么用iPad作这个实验而不用iPhone？一开始是用iPhone来着，用了两个iPhone越狱后都让我折腾白苹果了，只能刷到最新的固件，最新的固件又还没发越狱。所以血与泪的教训告诉我，越狱不容易，不要瞎折腾。



