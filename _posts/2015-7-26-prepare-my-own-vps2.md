---
layout: post
title:  "折腾自己的服务器系列（二）之解析域名到服务器"
date:   2015-08-01 18:58:33
categories: jekyll update
tags:
  - Linux
---

生命不息，折腾不止。此次系列主要记录怎么将自己的域名解析到服务器上。当然，首先，你需要一个域名。这里吐槽下阿里云，我是因为买域名送了买服务器的优惠券才选择购买的阿里云，到头来我要将自己的域名解析到阿里云的时候，阿里云又需要备案域名才可以解析，我购买的服务器的期限是1个月，估计备案域名的时间也需要这么长时间，意味着备案成功后，我的服务器也到期了。那我还解析个毛啊，果断退了阿里云服务器，购买了香港的vps。

解析域名，当然首推[Dnspod](https://www.dnspod.cn/). 注册也挺方便，直接使用QQ扫描登陆授权就可以了。

首先需要添加一条域名记录，默认新添加一条记录后是这个样子：

![](/assets/2015/img_prepaer_vps1.png)

需要把红线框住的两条`NS记录`提交到域名提供商那里。因为我的域名是从万网买的，所以要登陆阿里云，点击“修改DNS”，将DNS记录修改为Dnspod提供的那两条记录

![](/assets/2015/img_prepaer_vps2.png)

至此，以后所有域名的操作都可以在Dnspod上搞定了，跟阿里云没有关系了。

接下来就折腾下怎么把主域名解析到服务器www目录，以及解析一个二级域名到服务器自定义的一个目录。

##解析主域名
当我们需要将域名解析到我们服务器的公网ip的时候，就需要在Dnspod上添加记录，如图：

![](/assets/2015/img_prepaer_vps3.png)

可以看出，我们在刚才的基础上添加了两条`A记录`。A记录的意思是把域名解析到一个ip地址，是符合我们当下的需求的。

在主机记录栏，分别添加了`@`和`www`两条，分别对应的意思是：

	// 假设域名是bbbb
	@ ： 通过浏览器访问 bbbb.com 会跳转到服务器
	www ：通过浏览器访问 www.bbbb.com 会跳转到服务器
	
在记录值栏，要添加成服务器的公网ip，假如你的服务器的公网ip是`100.200.160.70`, 就填这个地址就可以。

现在，等dns解析生效，在浏览器中访问自己的域名，应该可以跳转到服务器了。

##解析二级域名
假设主域名是bbbb.com, 二级域名是类似`wx.bbbb.com`这种。现在的需求是把二级域名也解析到服务器上。还是需要添加记录：

![](/assets/2015/img_prepaer_vps4.png)

还是一条`A记录`，因为我们需要先把二级域名解析到服务器上，然后在服务器的Apache设置跳转规则，将二级域名跳转到指定目录。

在主机记录栏，添加了`wx`，意思是：

	// 假设域名是bbbb
	wx ： 通过浏览器访问 wx.bbbb.com 会跳转到服务器
	
在记录值那里还是填服务器的公网ip。
现在等dns解析生效，访问`wx.bbbb.com`就会跳转到服务器www目录了。显然这不是我们想要的结果。

需要指向指定目录，还要更改下Apache的配置：

	vi /etc/httpd/conf/httpd.conf
	
在配置文件末尾添加如下代码：

	RewriteEngine on
	RewriteMap lowercase int:tolower
	RewriteMap vhost txt:/etc/httpd/conf/vhost.map
	RewriteCond ${lowercase:%{SERVER_NAME}} ^(.+)$
	RewriteCond ${vhost:%1} ^(/.*)$
	RewriteRule ^/(.*)$ %1/$1

目的是告诉Apache，我们有一个`vhost.map`文件，通过这个文件来定义连接到服务器的二级域名该跳转到哪个目录。

接下来创建在`/etc/httpd/conf`这个目录下创建这个文件：

	vi vhost.map
	// 这个文件下添加下面的记录
	wx.bbbb.com /var/www/html/bbbb.com/wx
	
通过这个文件，Apache会把`wx.bbbb.com`这个域名解析到我们设置的那个目录去。以后的二级域名跳转规则都可以添加到这个文件下，并且不需要重启Apache服务就可以使之生效。

现在，通过浏览器访问`wx.bbbb.com`就可以跳转到我们刚才设置的那个目录了。

##最后
折腾服务器的这个系列就要先告一段落了，因为刚开始接触这些东西，有些东西并不是很深入，人生路漫漫，以后还要接着折腾。



	
